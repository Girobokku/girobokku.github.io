<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Revelaci√≥n a las 22:30</title>
  <meta name="description" content="Cuenta atr√°s que revela una imagen hoy a las 22:30 (hora local del navegador)." />
  <meta property="og:title" content="Revelaci√≥n a las 22:30" />
  <meta property="og:description" content="Cuenta atr√°s que revela una imagen hoy a las 22:30 (hora local del navegador)." />
  <meta property="og:type" content="website" />
  <style>
    :root{
      --bg: #0f172a;
      --fg: #e2e8f0;
      --muted: #94a3b8;
      --card: #111827;
      --accent: #22d3ee;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--fg);
      background: radial-gradient(1200px 800px at 70% 30%, #1f2937, var(--bg));
      display:grid; place-items:center;
    }
    main{width:min(100%, 900px); padding:24px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:24px; padding:32px; box-shadow:0 20px 50px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
    }
    h1{margin:0 0 10px; font-weight:800; letter-spacing:0.5px}
    .sub{color:var(--muted); margin:0 0 24px}
    .grid{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:14px}
    .tile{display:flex; flex-direction:column; align-items:center; padding:18px; background:var(--card); border-radius:18px; border:1px solid rgba(255,255,255,0.06)}
    .num{font-variant-numeric: tabular-nums; font-size: clamp(32px, 8vw, 64px); font-weight:900; line-height:1}
    .label{margin-top:6px; color:var(--muted); font-size:14px; letter-spacing:1px; text-transform:uppercase}
    .hidden{display:none !important}
    .reveal{display:flex; justify-content:center; align-items:center; padding:8px;}
    .reveal img{max-width:100%; height:auto; border-radius:20px; box-shadow:0 12px 40px rgba(0,0,0,.35)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    @media (max-width:520px){
      .grid{grid-template-columns: repeat(2, minmax(0,1fr))}
    }
  </style>
</head>
<body>
  <main>
    <section id="countdown-card" class="card" aria-live="polite">
      <h1>Revelaci√≥n a las <span id="target-text">22:30</span></h1>
      <p id="helper" class="sub">Faltan‚Ä¶</p>
      <div class="grid" role="timer" aria-atomic="true" aria-live="polite">
        <div class="tile"><div class="num" id="d">0</div><div class="label">d√≠as</div></div>
        <div class="tile"><div class="num" id="h">0</div><div class="label">horas</div></div>
        <div class="tile"><div class="num" id="m">0</div><div class="label">minutos</div></div>
        <div class="tile"><div class="num" id="s">0</div><div class="label">segundos</div></div>
      </div>
    </section>

    <section id="reveal-card" class="card reveal hidden">
      <h1>üéâ ¬°Desbloqueado!</h1>
      <div id="image-wrap"><img id="reveal-image" alt="Imagen revelada" loading="lazy" /></div>
    </section>

    <noscript>
      <p>Necesitas JavaScript para ver la cuenta atr√°s.</p>
    </noscript>
  </main>

  <script>
    const params = new URLSearchParams(location.search);
    const DEFAULT_TIME = "22:30";
    const timeStr = (params.get('time') || DEFAULT_TIME).trim();
    const dateStr = (params.get('date') || '').trim();
    const imageSrc = (params.get('image') || 'imagen.jpg').trim();
    const pageTitle = (params.get('title') || 'Revelaci√≥n a las ' + timeStr).trim();

    document.title = pageTitle;

    function buildTargetDate() {
      const now = new Date();
      let base = now;
      if (dateStr) {
        const [Y, M, D] = dateStr.split('-').map(Number);
        base = new Date(Y, (M - 1), D);
      }
      const [HH, MM] = timeStr.split(':').map(Number);
      const target = new Date(base.getFullYear(), base.getMonth(), base.getDate(), HH, MM || 0, 0, 0);
      return target;
    }

    const targetDate = buildTargetDate();

    const targetText = document.getElementById('target-text');
    try {
      const fmt = new Intl.DateTimeFormat(undefined, { hour: '2-digit', minute:'2-digit' });
      targetText.textContent = fmt.format(targetDate);
    } catch { targetText.textContent = timeStr; }

    const $d = document.getElementById('d');
    const $h = document.getElementById('h');
    const $m = document.getElementById('m');
    const $s = document.getElementById('s');

    const $countdownCard = document.getElementById('countdown-card');
    const $revealCard = document.getElementById('reveal-card');
    const $revealImg = document.getElementById('reveal-image');
    $revealImg.src = imageSrc;

    function pad(n){ return String(n).padStart(2,'0'); }

    function updateCountdown(){
      const now = new Date();
      const diff = targetDate.getTime() - now.getTime();

      if (diff <= 0){
        reveal();
        return;
      }
      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      $d.textContent = days;
      $h.textContent = pad(hours);
      $m.textContent = pad(minutes);
      $s.textContent = pad(seconds);
    }

    function reveal(){
      $countdownCard.classList.add('hidden');
      $revealCard.classList.remove('hidden');
      clearInterval(timerId);
    }

    if ((new Date()).getTime() >= targetDate.getTime()){
      reveal();
    } else {
      updateCountdown();
      var timerId = setInterval(updateCountdown, 1000);
    }

    const helper = document.getElementById('helper');
    let a11yTick = 0;
    const a11yInterval = setInterval(() => {
      a11yTick++;
      if ($countdownCard.classList.contains('hidden')){ clearInterval(a11yInterval); return; }
      const d = Number($d.textContent), h=Number($h.textContent), m=Number($m.textContent), s=Number($s.textContent);
      helper.textContent = `Faltan ${d} d√≠a${d!==1?'s':''}, ${h} hora${h!==1?'s':''}, ${m} minuto${m!==1?'s':''} y ${s} segundo${s!==1?'s':''}.`;
    }, 10000);
  </script>
</body>
</html>
